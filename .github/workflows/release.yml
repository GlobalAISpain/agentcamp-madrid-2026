name: Create Release Package

on:
  workflow_dispatch:
    inputs:
      version:
        description: 'Version number (e.g., 1.0.0)'
        required: true
        default: '1.0.0'
      prerelease:
        description: 'Mark as pre-release'
        required: false
        type: boolean
        default: false
  push:
    tags:
      - 'v*.*.*'

permissions:
  contents: write

jobs:
  create-release:
    name: Create Release Package
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout Repository
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Set Version
        id: version
        run: |
          if [[ "${{ github.event_name }}" == "workflow_dispatch" ]]; then
            VERSION="${{ github.event.inputs.version }}"
          else
            VERSION=${GITHUB_REF#refs/tags/v}
          fi
          echo "version=$VERSION" >> $GITHUB_OUTPUT
          echo "tag=v$VERSION" >> $GITHUB_OUTPUT

      - name: Create Release Package
        run: |
          VERSION="${{ steps.version.outputs.version }}"
          PACKAGE_NAME="agentcamp-madrid-2026-v${VERSION}"
          
          echo "ðŸ“¦ Creating release package for version ${VERSION}..."
          
          # Crear directorio temporal
          mkdir -p release-temp/$PACKAGE_NAME
          
          # Copiar archivos principales
          cp README.md release-temp/$PACKAGE_NAME/
          cp LICENSE release-temp/$PACKAGE_NAME/
          cp CODE_OF_CONDUCT.md release-temp/$PACKAGE_NAME/
          
          # Copiar carpetas de contenido
          cp -r branding release-temp/$PACKAGE_NAME/
          cp -r speakers release-temp/$PACKAGE_NAME/
          cp -r sponsors release-temp/$PACKAGE_NAME/
          cp -r templates release-temp/$PACKAGE_NAME/
          
          # Crear archivo de informaciÃ³n de release
          cat > release-temp/$PACKAGE_NAME/RELEASE_INFO.txt << EOF
          AgentCamp 2026 - Madrid
          Release Version: ${VERSION}
          Release Date: $(date +"%Y-%m-%d")
          
          Este paquete contiene todos los materiales del evento:
          
          ðŸ“ Contenido incluido:
          - ðŸ“„ README.md - InformaciÃ³n completa del evento
          - ðŸŽ¨ branding/ - Logos, grÃ¡ficos y materiales de marca
          - ðŸŽ¤ speakers/ - InformaciÃ³n de los ponentes
          - ðŸ¤ sponsors/ - InformaciÃ³n de los patrocinadores
          - ðŸ“‹ templates/ - Plantillas de presentaciÃ³n
          - ðŸ“œ LICENSE - Licencia del proyecto
          - ðŸ¤ CODE_OF_CONDUCT.md - CÃ³digo de conducta
          
          ðŸŒ Website: https://www.globalai.es
          ðŸ“… Agenda: https://agentcamp.sessionize.com
          ðŸŽŸï¸ Entradas: https://www.eventbrite.es/e/entradas-agentcamp-2026-madrid-aka-global-ai-bootcamp-1980480271806
          
          ðŸ“ UbicaciÃ³n:
          - Workshops (27 Feb): NTT DATA Spain, Madrid
          - Conferencia (28 Feb): Universidad CEU San Pablo, Boadilla del Monte, Madrid
          
          Para mÃ¡s informaciÃ³n, visita el README.md incluido en este paquete.
          EOF
          
          # Crear archivo ZIP
          cd release-temp
          zip -r "../${PACKAGE_NAME}.zip" "$PACKAGE_NAME"
          cd ..
          
          # Crear archivo TAR.GZ
          tar -czf "${PACKAGE_NAME}.tar.gz" -C release-temp "$PACKAGE_NAME"
          
          # Generar checksums
          sha256sum "${PACKAGE_NAME}.zip" > "${PACKAGE_NAME}.zip.sha256"
          sha256sum "${PACKAGE_NAME}.tar.gz" > "${PACKAGE_NAME}.tar.gz.sha256"
          
          echo "âœ… Release package created successfully!"
          ls -lh ${PACKAGE_NAME}.*

      - name: Generate Release Notes
        id: release_notes
        run: |
          VERSION="${{ steps.version.outputs.version }}"
          
          cat > release_notes.md << 'EOF'
          # ðŸŽ‰ AgentCamp 2026 - Madrid | Release v$VERSION
          
          Â¡Bienvenido al paquete oficial de materiales del AgentCamp 2026 Madrid!
          
          ## ðŸ“¦ Contenido del Paquete
          
          Este release incluye todos los materiales y recursos del evento:
          
          ### ðŸ“ Contenido Incluido
          
          - **ðŸ“„ DocumentaciÃ³n**: README completo con toda la informaciÃ³n del evento
          - **ðŸŽ¨ Branding**: Logos, grÃ¡ficos y materiales visuales de alta calidad
          - **ðŸŽ¤ Speakers**: InformaciÃ³n de los ponentes y sus sesiones
          - **ðŸ¤ Sponsors**: Detalles de los patrocinadores oficiales
          - **ðŸ“‹ Templates**: Plantillas de PowerPoint para presentaciones
          - **ðŸ“œ Licencias**: LICENSE y CODE_OF_CONDUCT
          
          ## ðŸ“… InformaciÃ³n del Evento
          
          - **Workshops**: Viernes 27 de Febrero de 2026
            - ðŸ“ NTT DATA Spain, Madrid
            - â° MaÃ±ana (10:00-14:00) y Tarde (15:00-19:00)
          
          - **Conferencia**: SÃ¡bado 28 de Febrero de 2026
            - ðŸ“ Universidad CEU San Pablo, Boadilla del Monte, Madrid
            - â° 08:30 - 19:00
          
          ## ðŸ”— Enlaces Ãštiles
          
          - ðŸŒ **Website**: [globalai.es](https://www.globalai.es)
          - ðŸ“… **Agenda**: [agentcamp.sessionize.com](https://agentcamp.sessionize.com)
          - ðŸŽŸï¸ **Entradas**: [Eventbrite](https://www.eventbrite.es/e/entradas-agentcamp-2026-madrid-aka-global-ai-bootcamp-1980480271806)
          
          ## ðŸ’¾ Formatos Disponibles
          
          - **ZIP**: Recomendado para Windows
          - **TAR.GZ**: Recomendado para Linux/macOS
          
          Ambos archivos incluyen el mismo contenido. Los checksums SHA256 estÃ¡n disponibles para verificar la integridad de las descargas.
          
          ## âœ… VerificaciÃ³n de Integridad
          
          Descarga el archivo `.sha256` correspondiente y verifica:
          
          ```bash
          # Para ZIP
          sha256sum -c agentcamp-madrid-2026-v$VERSION.zip.sha256
          
          # Para TAR.GZ
          sha256sum -c agentcamp-madrid-2026-v$VERSION.tar.gz.sha256
          ```
          
          ## ðŸŽ¯ Temas Principales
          
          - ðŸ¤– Agentes de IA y arquitecturas multiagente
          - ðŸ”Œ Model Context Protocol (MCP)
          - ðŸ­ Microsoft Foundry
          - ðŸ’¡ Microsoft Copilot
          - ðŸ“Š Microsoft Fabric
          - ðŸŽ“ Azure Machine Learning
          
          ---
          
          **Gracias por tu interÃ©s en AgentCamp 2026!** ðŸš€
          
          Si tienes preguntas, visita nuestro repositorio o contacta con los organizadores.
          EOF
          
          # Reemplazar la variable VERSION
          sed -i "s/\$VERSION/${VERSION}/g" release_notes.md
          
          echo "notes_file=release_notes.md" >> $GITHUB_OUTPUT

      - name: Create GitHub Release
        uses: softprops/action-gh-release@v1
        with:
          tag_name: ${{ steps.version.outputs.tag }}
          name: AgentCamp 2026 Madrid - v${{ steps.version.outputs.version }}
          body_path: release_notes.md
          draft: false
          prerelease: ${{ github.event.inputs.prerelease || false }}
          files: |
            agentcamp-madrid-2026-v${{ steps.version.outputs.version }}.zip
            agentcamp-madrid-2026-v${{ steps.version.outputs.version }}.zip.sha256
            agentcamp-madrid-2026-v${{ steps.version.outputs.version }}.tar.gz
            agentcamp-madrid-2026-v${{ steps.version.outputs.version }}.tar.gz.sha256
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}

      - name: Summary
        run: |
          VERSION="${{ steps.version.outputs.version }}"
          echo "## âœ… Release v${VERSION} Created Successfully! ðŸŽ‰" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "### ðŸ“¦ Archivos Generados:" >> $GITHUB_STEP_SUMMARY
          echo "- \`agentcamp-madrid-2026-v${VERSION}.zip\`" >> $GITHUB_STEP_SUMMARY
          echo "- \`agentcamp-madrid-2026-v${VERSION}.tar.gz\`" >> $GITHUB_STEP_SUMMARY
          echo "- Checksums SHA256 incluidos" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "ðŸ”— **Release URL**: https://github.com/${{ github.repository }}/releases/tag/v${VERSION}" >> $GITHUB_STEP_SUMMARY
